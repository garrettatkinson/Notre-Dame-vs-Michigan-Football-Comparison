---
title: "Notre Dame vs Michigan"
author: "Mendoza College of Business"
date: '2023-01-11'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Setup
```{r}
library(ggplot2) # Load ggplot2
library(ggdark) # Load ggdark
library(ggimage) # Load ggimage
library(reshape) # Load reshape
library(ggridges) # Load ggridges
library(ggrepel) # Load ggrepel
library(tidyverse)
library(cfbfastR)
```

```{r}
# Load Functions:
source("sports_analytics_functions.r")
```


```{r}
load("team_logos.rda")
```

The next few columns relate to the offensive performance of the school:

* pass_n - Number of passes thrown
* pass_yards - Total pass yards 
* pass_epa - Total pass EPA (Expected points added)
* pass_wpa - Total pass WPA (Win probability added)

* rush_n - Number of rushes
* rush_yards - Total rush yards
* rush_epa - Total rush EPA (Expected points added)
* rush_wpa - Total Rush WPA (Win probability added)

We then have the offensive statistics at a per play level:

* pass_yards_per_play - Pass yards per play    
* pass_epa_per_play - Pass EPA (Expected points added) per play
* pass_wpa_per_play - Pass WPA (Win probability added) per play

* rush_yards_per_play - Rush yards_per_play
* rush_epa_per_play - Rush EPA (Expected points added) per play
* rush_wpa_per_play - Rush WPA (Win probability added) per play     

The next set of columns relate to the defensive performance of the school:

* pass_n_def - Number of passes defended
* pass_yards_def - Total pass yards against
* pass_epa_def - Total pass EPA against (Expected points added)
* pass_wpa_def - Total pass WPA against (Win probability added)

* rush_n_def - Number of rushes defended
* rush_yards_def - Total rush yards against
* rush_epa_def - Total rush EPA against (Expected points added)
* rush_wpa_def - Total rush WPA against (Win probability added)
 
Finally we have the defensive statistics at a per play level:

* pass_yards_per_play_def - Pass yards against per play
* pass_epa_per_play_def - Pass EPA against (Expected points added) per play
* pass_wpa_per_play_def - Pass WPA against (Win probability added) per play

* rush_yards_per_play_def - Rush yards against per play
* rush_epa_per_play_def - Rush EPA against (Expected points added) per play
* rush_wpa_per_play_def - Rush WPA against (Win probability added) per play


#### 2015 Season ####


### 2015 Notre Dame Analysis ###

Setup
```{r}
library(ggplot2) # Load ggplot2
library(ggdark) # Load ggdark
library(ggimage) # Load ggimage
library(reshape) # Load reshape
library(ggridges) # Load ggridges
library(ggrepel) # Load ggrepel
library(tidyverse)
library(cfbfastR)
```

Load 2015 Season
```{r}
# Load data
cfb_2015 <- load_cfb_pbp(seasons = 2015)
# Convert to data frame
cfb_2015 <- as.data.frame(cfb_2015)
```

Play by Play
```{r}
# Create summarized play type
s_play_type <- create_simplex_play_type(cfb_2015)
# Add summarized play type back to dataset
cfb_2015$playtype <- s_play_type
head(cfb_2015)
```



2015 Notre Dame Offensive Stats
```{r}
nd_off_2015 <- cfb_2015[which(cfb_2015$pos_team == "Notre Dame" &
                     cfb_2015$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]


nd_off_2015_m <- melt(nd_off_2015[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2015 ND Offense EPA
```{r}
# Create plot
ggplot(nd_off_2015_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "Notre Dame Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2015 Notre Dame Defense
```{r}
nd_def_2015 <- cfb_2015[which(cfb_2015$def_pos_team == "Notre Dame" &
                     cfb_2015$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_def_2015_m <- melt(nd_def_2015[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2015 ND Defense EPA
```{r}
# Create plot
ggplot(nd_def_2015_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "Notre Dame Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

```{r}
y1_2015_stats <- create_team_summary(pbp = cfb_2015[cfb_2015$yards_to_goal >= 80,], 
                                team_logos = team_logos)

# Calculate statistics for 20 - 50
y2_2015_stats <- create_team_summary(pbp = cfb_2015[cfb_2015$yards_to_goal >= 50 &
                                                 cfb_2015$yards_to_goal < 80,], 
                                team_logos = team_logos)

# Calculate statistics for 50 - 79
y3_2015_stats <- create_team_summary(pbp = cfb_2015[cfb_2015$yards_to_goal >= 21 &
                                                 cfb_2015$yards_to_goal < 50,], 
                                team_logos = team_logos)
# Calculate statistics for 80 - 100
y4_2015_stats <- create_team_summary(pbp = cfb_2015[cfb_2015$yards_to_goal >= 0 &
                                                 cfb_2015$yards_to_goal < 20,], 
                                team_logos = team_logos)


```

2015 Notre Dame
```{r}
# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_yards_2015 <- rbind.data.frame(y1_2015_stats[y1_2015_stats$school == team,],
                             y2_2015_stats[y2_2015_stats$school == team,],
                             y3_2015_stats[y3_2015_stats$school == team,],
                             y4_2015_stats[y4_2015_stats$school == team,])

# Create plot for offensive EPA
nd_epa_off_2015 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = team, # Set  Team
                 res_1 = nd_by_yards_2015, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
nd_epa_off_2015

# Create plot for offensive yards
nd_yards_2015 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2015, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
nd_yards_2015
```

2015 Defensive Stats
```{r}
# Create plot for defensive EPA
nd_epa_def_2015 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2015, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
nd_epa_def_2015

# Yards
# Create plot for defensive yards
nd_yards_2015_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2015, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
nd_yards_2015_def
```

## 2015 Michigan

2015 Michigan Offensive Stats
```{r}
mich_off_2015 <- cfb_2015[which(cfb_2015$pos_team == "Michigan" &
                     cfb_2015$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_off_2015_m <- melt(mich_off_2015[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2015 Michigan Offense EPA
```{r}
# Create plot
ggplot(mich_off_2015_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "Michigan Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2015 Michigan Defense
```{r}
mich_def_2015 <- cfb_2015[which(cfb_2015$def_pos_team == "Michigan" &
                     cfb_2015$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_def_2015_m <- melt(mich_def_2015[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```


2015 Michigan Defense EPA
```{r}
# Create plot
ggplot(mich_def_2015_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2015 Michigan Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

2015 Michigan Offense
```{r}
# Set team as Notre Dame
team <- "Michigan"

# Extract Notre Dame statistics
mich_by_yards_2015 <- rbind.data.frame(y1_2015_stats[y1_2015_stats$school == team,],
                             y2_2015_stats[y2_2015_stats$school == team,],
                             y3_2015_stats[y3_2015_stats$school == team,],
                             y4_2015_stats[y4_2015_stats$school == team,])

# Create plot for offensive EPA
mich_epa_off_2015 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2015, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
mich_epa_off_2015

# Create plot for offensive yards
mich_yards_2015 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2015, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
mich_yards_2015

```


2015 Michigan Defensive Stats
```{r}
# Create plot for defensive EPA
mich_epa_def_2015 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2015, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
mich_epa_def_2015

# Yards
# Create plot for defensive yards
mich_yards_2015_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2015, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
mich_yards_2015_def
```

### 2015 Notre Dame vs Michigan Matchup

```{r}
# Setting Data Up
# ND Pass and Rush Offense and Defense
nd_by_yards_2015$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
nd_by_yards_2015$zone_pass_num <- paste(nd_by_yards_2015$zone, ": ", nd_by_yards_2015$pass_n, sep = "")
nd_by_yards_2015$zone_rush_num <- paste(nd_by_yards_2015$zone, ": ", nd_by_yards_2015$rush_n, sep = "")
nd_by_yards_2015$zone_pass_num_def <- paste(nd_by_yards_2015$zone, ": ", nd_by_yards_2015$pass_n_def, sep = "")
nd_by_yards_2015$zone_rush_num_def <- paste(nd_by_yards_2015$zone, ": ", nd_by_yards_2015$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_yards_2015$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
mich_by_yards_2015$zone_pass_num <- paste(mich_by_yards_2015$zone, ": ", mich_by_yards_2015$pass_n, sep = "")
mich_by_yards_2015$zone_rush_num <- paste(mich_by_yards_2015$zone, ": ", mich_by_yards_2015$rush_n, sep = "")
mich_by_yards_2015$zone_pass_num_def <- paste(mich_by_yards_2015$zone, ": ", mich_by_yards_2015$pass_n_def, sep = "")
mich_by_yards_2015$zone_rush_num_def <- paste(mich_by_yards_2015$zone, ": ", mich_by_yards_2015$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2015 <- cbind.data.frame(nd_by_yards_2015$zone, 
                                    ((nd_by_yards_2015$pass_wpa_per_play + mich_by_yards_2015$pass_wpa_per_play_def)/2),
                                    ((nd_by_yards_2015$pass_epa_per_play + mich_by_yards_2015$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2015) <- c("zone", "exp_wpa", "exp_epa")
nd_v_mich_rush_2015 <- cbind.data.frame(nd_by_yards_2015$zone, 
                                    ((nd_by_yards_2015$rush_wpa_per_play + mich_by_yards_2015$rush_wpa_per_play_def)/2),
                                    ((nd_by_yards_2015$rush_epa_per_play + mich_by_yards_2015$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2015) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_pass_2015 <- cbind.data.frame(mich_by_yards_2015$zone, 
                                    ((mich_by_yards_2015$pass_wpa_per_play + nd_by_yards_2015$pass_wpa_per_play_def)/2),
                                    ((mich_by_yards_2015$pass_epa_per_play + nd_by_yards_2015$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2015) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_rush_2015 <- cbind.data.frame(mich_by_yards_2015$zone, 
                                    ((mich_by_yards_2015$rush_wpa_per_play + nd_by_yards_2015$rush_wpa_per_play_def)/2),
                                    ((mich_by_yards_2015$rush_epa_per_play + nd_by_yards_2015$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2015) <- c("zone", "exp_wpa", "exp_epa")

```


WPA Graphs by Field Position
```{r}
# ND Passing Offense vs Michigan Passing Defense
g_2015_1 <- ggplot(data = nd_v_mich_pass_2015, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2015_1

# ND Rushing Offense vs Michigan Rushing Defense
g_2015_2 <- ggplot(data = nd_v_mich_rush_2015, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2015_2

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2015_3 <- ggplot(data = mich_v_nd_pass_2015, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2015_3

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2015_4 <- ggplot(data = mich_v_nd_rush_2015, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2015_4
```
According to WPA, Notre Dame in 2015 would be about equally as successful either running or passing the ball over Michigan, while Michigan in 2015 would matchup well against the Irish in the passing attack. Best individual matchup would be Michigan's passing offense against Notre Dame's passing defense.



EPA Graphs by Field Position
```{r}

# ND Passing Offense vs Michigan Passing Defense
g_2015_5 <- ggplot(data = nd_v_mich_pass_2015, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2015_5

# ND Rushing Offense vs Michigan Rushing Defense
g_2015_6 <- ggplot(data = nd_v_mich_rush_2015, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2015_6

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2015_7 <- ggplot(data = mich_v_nd_pass_2015, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2015_7

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2015_8 <- ggplot(data = mich_v_nd_rush_2015, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2015_8
```
According to EPA, Notre Dame would be much wiser to run the ball on Michigan while Michigan should focus on passing the ball more against Notre Dame in 2015. Michigan's passing attack against ND's pass defense is the most favorable individual matchup.


Extracting Plays by Downs
```{r}
z1_2015_stats <- create_team_summary(pbp = cfb_2015[cfb_2015$down == 1,], 
                                team_logos = team_logos)

# Calculate statistics for 2nd Down
z2_2015_stats <- create_team_summary(pbp = cfb_2015[cfb_2015$down == 2,], 
                                team_logos = team_logos)

# Calculate statistics for 3rd Down
z3_2015_stats <- create_team_summary(pbp = cfb_2015[cfb_2015$down == 3,], 
                                team_logos = team_logos)
# Calculate statistics for 4th Down
z4_2015_stats <- create_team_summary(pbp = cfb_2015[cfb_2015$down == 4,], 
                                team_logos = team_logos)

# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_down_2015 <- rbind.data.frame(z1_2015_stats[z1_2015_stats$school == team,],
                             z2_2015_stats[z2_2015_stats$school == team,],
                             z3_2015_stats[z3_2015_stats$school == team,],
                             z4_2015_stats[z4_2015_stats$school == team,])

# Set team as Michigan
team <- "Michigan"

# Extract Michigan statistics
mich_by_down_2015 <- rbind.data.frame(z1_2015_stats[z1_2015_stats$school == team,],
                             z2_2015_stats[z2_2015_stats$school == team,],
                             z3_2015_stats[z3_2015_stats$school == team,],
                             z4_2015_stats[z4_2015_stats$school == team,])

```

Setup Comparisons by Down

```{r}
# ND Pass and Rush Offense and Defense
nd_by_down_2015$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
nd_by_down_2015$down_pass_num <- paste(nd_by_down_2015$down, ": ", nd_by_down_2015$pass_n, sep = "")
nd_by_down_2015$down_rush_num <- paste(nd_by_down_2015$down, ": ", nd_by_down_2015$rush_n, sep = "")
nd_by_down_2015$down_pass_num_def <- paste(nd_by_down_2015$down, ": ", nd_by_down_2015$pass_n_def, sep = "")
nd_by_down_2015$down_rush_num_def <- paste(nd_by_down_2015$down, ": ", nd_by_down_2015$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_down_2015$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
mich_by_down_2015$down_pass_num <- paste(mich_by_down_2015$down, ": ", mich_by_down_2015$pass_n, sep = "")
mich_by_down_2015$down_rush_num <- paste(mich_by_down_2015$down, ": ", mich_by_down_2015$rush_n, sep = "")
mich_by_down_2015$down_pass_num_def <- paste(mich_by_down_2015$down, ": ", mich_by_down_2015$pass_n_def, sep = "")
mich_by_down_2015$down_rush_num_def <- paste(mich_by_down_2015$down, ": ", mich_by_down_2015$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2015_down <- cbind.data.frame(nd_by_down_2015$down, 
                                    ((nd_by_down_2015$pass_wpa_per_play + mich_by_down_2015$pass_wpa_per_play_def)/2),
                                    ((nd_by_down_2015$pass_epa_per_play + mich_by_down_2015$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2015_down) <- c("down", "exp_wpa", "exp_epa")
nd_v_mich_rush_2015_down <- cbind.data.frame(nd_by_down_2015$down, 
                                    ((nd_by_down_2015$rush_wpa_per_play + mich_by_down_2015$rush_wpa_per_play_def)/2),
                                    ((nd_by_down_2015$rush_epa_per_play + mich_by_down_2015$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2015_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_pass_2015_down <- cbind.data.frame(mich_by_down_2015$down, 
                                    ((mich_by_down_2015$pass_wpa_per_play + nd_by_down_2015$pass_wpa_per_play_def)/2),
                                    ((mich_by_down_2015$pass_epa_per_play + nd_by_down_2015$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2015_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_rush_2015_down <- cbind.data.frame(mich_by_down_2015$down, 
                                    ((mich_by_down_2015$rush_wpa_per_play + nd_by_down_2015$rush_wpa_per_play_def)/2),
                                    ((mich_by_down_2015$rush_epa_per_play + nd_by_down_2015$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2015_down) <- c("down", "exp_wpa", "exp_epa")

```

WPA Graphs by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2015_1 <- ggplot(data = nd_v_mich_pass_2015_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2015_1

# ND Rushing Offense vs Michigan Rushing Defense
d_2015_2 <- ggplot(data = nd_v_mich_rush_2015_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2015_2

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2015_3 <- ggplot(data = mich_v_nd_pass_2015_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2015_3

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2015_4 <- ggplot(data = mich_v_nd_rush_2015_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2015_4
```
Looking at it by down WPA reinforces that Notre Dame's offense would be best served as a balanced attack, while Michigan would be much better suited to pass the ball against ND's defense.


EPA by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2015_5 <- ggplot(data = nd_v_mich_pass_2015_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2015_5

# ND Rushing Offense vs Michigan Rushing Defense
d_2015_6 <- ggplot(data = nd_v_mich_rush_2015_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2015_6

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2015_7 <- ggplot(data = mich_v_nd_pass_2015_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2015_7

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2015_8 <- ggplot(data = mich_v_nd_rush_2015_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2015 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2015_8
```

EPA by down paints a scenario where Notre Dame is more likely to have success running the ball on Michigan as opposed to relying on their passing game, while Michigan's passing attack once again garners a more favored outlook compared to their rushing attack.

### 2016 Season

Load 2016 Season
```{r}
# Load data
cfb_2016 <- load_cfb_pbp(seasons = 2016)
# Convert to data frame
cfb_2016 <- as.data.frame(cfb_2016)
```

Play by Play
```{r}
# Create summarized play type
s_play_type <- create_simplex_play_type(cfb_2016)
# Add summarized play type back to dataset
cfb_2016$playtype <- s_play_type

```

2016 Notre Dame Offensive Stats
```{r}
nd_off_2016 <- cfb_2016[which(cfb_2016$pos_team == "Notre Dame" &
                     cfb_2016$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_off_2016_m <- melt(nd_off_2016[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))

```

2016 ND Offense EPA
```{r}
# Create plot
ggplot(nd_off_2016_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2016 Notre Dame Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2016 Notre Dame Defense
```{r}
nd_def_2016 <- cfb_2016[which(cfb_2016$def_pos_team == "Notre Dame" &
                     cfb_2016$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_def_2016_m <- melt(nd_def_2016[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2016 ND Defense EPA
```{r}
# Create plot
ggplot(nd_def_2016_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2016 Notre Dame Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

```{r}
y1_2016_stats <- create_team_summary(pbp = cfb_2016[cfb_2016$yards_to_goal >= 80,], 
                                team_logos = team_logos)

# Calculate statistics for 20 - 50
y2_2016_stats <- create_team_summary(pbp = cfb_2016[cfb_2016$yards_to_goal >= 50 &
                                                 cfb_2016$yards_to_goal < 80,], 
                                team_logos = team_logos)

# Calculate statistics for 50 - 79
y3_2016_stats <- create_team_summary(pbp = cfb_2016[cfb_2016$yards_to_goal >= 21 &
                                                 cfb_2016$yards_to_goal < 50,], 
                                team_logos = team_logos)
# Calculate statistics for 80 - 100
y4_2016_stats <- create_team_summary(pbp = cfb_2016[cfb_2016$yards_to_goal >= 0 &
                                                 cfb_2016$yards_to_goal < 20,], 
                                team_logos = team_logos)
```




2016 Notre Dame Offense by Field Position
```{r}
# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_yards_2016 <- rbind.data.frame(y1_2016_stats[y1_2016_stats$school == team,],
                             y2_2016_stats[y2_2016_stats$school == team,],
                             y3_2016_stats[y3_2016_stats$school == team,],
                             y4_2016_stats[y4_2016_stats$school == team,])

# Create plot for offensive EPA
nd_epa_off_2016 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2016, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
nd_epa_off_2016

# Create plot for offensive yards
nd_yards_2016 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2016, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
nd_yards_2016
```

2016 Notre Dame defense by field position
```{r}
# Create plot for defensive EPA
nd_epa_def_2016 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2016, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
nd_epa_def_2016

# Yards
# Create plot for defensive yards
nd_yards_2016_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2016, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
nd_yards_2016_def
```

## 2016 Michigan

2016 Michigan Offensive Stats
```{r}
mich_off_2016 <- cfb_2016[which(cfb_2016$pos_team == "Michigan" &
                     cfb_2016$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_off_2016_m <- melt(mich_off_2016[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))

```

2016 Michigan Offense EPA
```{r}
# Create plot
ggplot(mich_off_2016_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2016 Michigan Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2016 Michigan Defense
```{r}
mich_def_2016 <- cfb_2016[which(cfb_2016$def_pos_team == "Michigan" &
                     cfb_2016$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_def_2016_m <- melt(mich_def_2016[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```


2016 Michigan Defense EPA
```{r}
# Create plot
ggplot(mich_def_2016_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2016 Michigan Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

2016 Michigan Offense
```{r}
# Set team as Notre Dame
team <- "Michigan"

# Extract Notre Dame statistics
mich_by_yards_2016 <- rbind.data.frame(y1_2016_stats[y1_2016_stats$school == team,],
                             y2_2016_stats[y2_2016_stats$school == team,],
                             y3_2016_stats[y3_2016_stats$school == team,],
                             y4_2016_stats[y4_2016_stats$school == team,])

# Create plot for offensive EPA
mich_epa_off_2016 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2016, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
mich_epa_off_2016

# Create plot for offensive yards
mich_yards_2016 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2016, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
mich_yards_2016
```

```{r}
# Create plot for defensive EPA
mich_epa_def_2016 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2016, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
mich_epa_def_2016

# Yards
# Create plot for defensive yards
mich_yards_2016_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2016, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
mich_yards_2016_def
```

### 2016 Notre Dame vs Michigan Matchup

```{r}
# Setting Data Up
# ND Pass and Rush Offense and Defense
nd_by_yards_2016$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
nd_by_yards_2016$zone_pass_num <- paste(nd_by_yards_2016$zone, ": ", nd_by_yards_2016$pass_n, sep = "")
nd_by_yards_2016$zone_rush_num <- paste(nd_by_yards_2016$zone, ": ", nd_by_yards_2016$rush_n, sep = "")
nd_by_yards_2016$zone_pass_num_def <- paste(nd_by_yards_2016$zone, ": ", nd_by_yards_2016$pass_n_def, sep = "")
nd_by_yards_2016$zone_rush_num_def <- paste(nd_by_yards_2016$zone, ": ", nd_by_yards_2016$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_yards_2016$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
mich_by_yards_2016$zone_pass_num <- paste(mich_by_yards_2016$zone, ": ", mich_by_yards_2016$pass_n, sep = "")
mich_by_yards_2016$zone_rush_num <- paste(mich_by_yards_2016$zone, ": ", mich_by_yards_2016$rush_n, sep = "")
mich_by_yards_2016$zone_pass_num_def <- paste(mich_by_yards_2016$zone, ": ", mich_by_yards_2016$pass_n_def, sep = "")
mich_by_yards_2016$zone_rush_num_def <- paste(mich_by_yards_2016$zone, ": ", mich_by_yards_2016$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2016 <- cbind.data.frame(nd_by_yards_2016$zone, 
                                    ((nd_by_yards_2016$pass_wpa_per_play + mich_by_yards_2016$pass_wpa_per_play_def)/2),
                                    ((nd_by_yards_2016$pass_epa_per_play + mich_by_yards_2016$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2016) <- c("zone", "exp_wpa", "exp_epa")
nd_v_mich_rush_2016 <- cbind.data.frame(nd_by_yards_2016$zone, 
                                    ((nd_by_yards_2016$rush_wpa_per_play + mich_by_yards_2016$rush_wpa_per_play_def)/2),
                                    ((nd_by_yards_2016$rush_epa_per_play + mich_by_yards_2016$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2016) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_pass_2016 <- cbind.data.frame(mich_by_yards_2016$zone, 
                                    ((mich_by_yards_2016$pass_wpa_per_play + nd_by_yards_2016$pass_wpa_per_play_def)/2),
                                    ((mich_by_yards_2016$pass_epa_per_play + nd_by_yards_2016$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2016) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_rush_2016 <- cbind.data.frame(mich_by_yards_2016$zone, 
                                    ((mich_by_yards_2016$rush_wpa_per_play + nd_by_yards_2016$rush_wpa_per_play_def)/2),
                                    ((mich_by_yards_2016$rush_epa_per_play + nd_by_yards_2016$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2016) <- c("zone", "exp_wpa", "exp_epa")

```


WPA Graphs by Field Position
```{r}
# ND Passing Offense vs Michigan Passing Defense
g_2016_1 <- ggplot(data = nd_v_mich_pass_2016, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2016_1

# ND Rushing Offense vs Michigan Rushing Defense
g_2016_2 <- ggplot(data = nd_v_mich_rush_2016, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2016_2

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2016_3 <- ggplot(data = mich_v_nd_pass_2016, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2016_3

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2016_4 <- ggplot(data = mich_v_nd_rush_2016, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2016_4
```
According to WPA, this paints a grim matchup for Notre Dame against Michigan. Notre Dame's offense would need to be balanced, while Michigan could practically run whatever they want on offense because they sweep all matchups against Notre Dame's defense.



EPA Graphs by Field Position
```{r}

# ND Passing Offense vs Michigan Passing Defense
g_2016_5 <- ggplot(data = nd_v_mich_pass_2016, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2016_5

# ND Rushing Offense vs Michigan Rushing Defense
g_2016_6 <- ggplot(data = nd_v_mich_rush_2016, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2016_6

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2016_7 <- ggplot(data = mich_v_nd_pass_2016, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2016_7

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2016_8 <- ggplot(data = mich_v_nd_rush_2016, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2016_8
```
EPA paints an even more grim matchup for the Irish, as the Irish offense wins less than half of the total matchups against Michigan's defense, while the Wolverines win every conceivable matchup against ND. Both should prioritize throwing the ball as opposed to running it.


Extracting Plays by Downs
```{r}
z1_2016_stats <- create_team_summary(pbp = cfb_2016[cfb_2016$down == 1,], 
                                team_logos = team_logos)

# Calculate statistics for 2nd Down
z2_2016_stats <- create_team_summary(pbp = cfb_2016[cfb_2016$down == 2,], 
                                team_logos = team_logos)

# Calculate statistics for 3rd Down
z3_2016_stats <- create_team_summary(pbp = cfb_2016[cfb_2016$down == 3,], 
                                team_logos = team_logos)
# Calculate statistics for 4th Down
z4_2016_stats <- create_team_summary(pbp = cfb_2016[cfb_2016$down == 4,], 
                                team_logos = team_logos)

# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_down_2016 <- rbind.data.frame(z1_2016_stats[z1_2016_stats$school == team,],
                             z2_2016_stats[z2_2016_stats$school == team,],
                             z3_2016_stats[z3_2016_stats$school == team,],
                             z4_2016_stats[z4_2016_stats$school == team,])

# Set team as Michigan
team <- "Michigan"

# Extract Michigan statistics
mich_by_down_2016 <- rbind.data.frame(z1_2016_stats[z1_2016_stats$school == team,],
                             z2_2016_stats[z2_2016_stats$school == team,],
                             z3_2016_stats[z3_2016_stats$school == team,],
                             z4_2016_stats[z4_2016_stats$school == team,])

```

Setup Comparisons by Down

```{r}
# ND Pass and Rush Offense and Defense
nd_by_down_2016$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
nd_by_down_2016$down_pass_num <- paste(nd_by_down_2016$down, ": ", nd_by_down_2016$pass_n, sep = "")
nd_by_down_2016$down_rush_num <- paste(nd_by_down_2016$down, ": ", nd_by_down_2016$rush_n, sep = "")
nd_by_down_2016$down_pass_num_def <- paste(nd_by_down_2016$down, ": ", nd_by_down_2016$pass_n_def, sep = "")
nd_by_down_2016$down_rush_num_def <- paste(nd_by_down_2016$down, ": ", nd_by_down_2016$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_down_2016$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
mich_by_down_2016$down_pass_num <- paste(mich_by_down_2016$down, ": ", mich_by_down_2016$pass_n, sep = "")
mich_by_down_2016$down_rush_num <- paste(mich_by_down_2016$down, ": ", mich_by_down_2016$rush_n, sep = "")
mich_by_down_2016$down_pass_num_def <- paste(mich_by_down_2016$down, ": ", mich_by_down_2016$pass_n_def, sep = "")
mich_by_down_2016$down_rush_num_def <- paste(mich_by_down_2016$down, ": ", mich_by_down_2016$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2016_down <- cbind.data.frame(nd_by_down_2016$down, 
                                    ((nd_by_down_2016$pass_wpa_per_play + mich_by_down_2016$pass_wpa_per_play_def)/2),
                                    ((nd_by_down_2016$pass_epa_per_play + mich_by_down_2016$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2016_down) <- c("down", "exp_wpa", "exp_epa")
nd_v_mich_rush_2016_down <- cbind.data.frame(nd_by_down_2016$down, 
                                    ((nd_by_down_2016$rush_wpa_per_play + mich_by_down_2016$rush_wpa_per_play_def)/2),
                                    ((nd_by_down_2016$rush_epa_per_play + mich_by_down_2016$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2016_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_pass_2016_down <- cbind.data.frame(mich_by_down_2016$down, 
                                    ((mich_by_down_2016$pass_wpa_per_play + nd_by_down_2016$pass_wpa_per_play_def)/2),
                                    ((mich_by_down_2016$pass_epa_per_play + nd_by_down_2016$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2016_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_rush_2016_down <- cbind.data.frame(mich_by_down_2016$down, 
                                    ((mich_by_down_2016$rush_wpa_per_play + nd_by_down_2016$rush_wpa_per_play_def)/2),
                                    ((mich_by_down_2016$rush_epa_per_play + nd_by_down_2016$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2016_down) <- c("down", "exp_wpa", "exp_epa")

```

WPA Graphs by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2016_1 <- ggplot(data = nd_v_mich_pass_2016_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2016_1

# ND Rushing Offense vs Michigan Rushing Defense
d_2016_2 <- ggplot(data = nd_v_mich_rush_2016_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2016_2

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2016_3 <- ggplot(data = mich_v_nd_pass_2016_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2016_3

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2016_4 <- ggplot(data = mich_v_nd_rush_2016_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2016_4
```
When analyzing WPA by down, ND should pass on first down, then run on other downs. Michigan still has a clear advantage over ND on offense.


EPA by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2016_5 <- ggplot(data = nd_v_mich_pass_2016_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2016_5

# ND Rushing Offense vs Michigan Rushing Defense
d_2016_6 <- ggplot(data = nd_v_mich_rush_2016_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2016_6

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2016_7 <- ggplot(data = mich_v_nd_pass_2016_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2016_7

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2016_8 <- ggplot(data = mich_v_nd_rush_2016_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2016 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2016_8
```

EPA by down paints a scenario where Notre dame should prioritize the ground attack, while Michigan should pass, although they still hold a sizable advantage over the Irish.

### 2017 Season

Load 2017 Season
```{r}
# Load data
cfb_2017 <- load_cfb_pbp(seasons = 2017)
# Convert to data frame
cfb_2017 <- as.data.frame(cfb_2017)
```

Play by Play
```{r}
# Create summarized play type
s_play_type <- create_simplex_play_type(cfb_2017)
# Add summarized play type back to dataset
cfb_2017$playtype <- s_play_type
```



2017 Notre Dame Offensive Stats
```{r}
nd_off_2017 <- cfb_2017[which(cfb_2017$pos_team == "Notre Dame" &
                     cfb_2017$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_off_2017_m <- melt(nd_off_2017[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))

```

2017 ND Offense EPA
```{r}
# Create plot
ggplot(nd_off_2017_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2017 Notre Dame Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2017 Notre Dame Defense
```{r}
nd_def_2017 <- cfb_2017[which(cfb_2017$def_pos_team == "Notre Dame" &
                     cfb_2017$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_def_2017_m <- melt(nd_def_2017[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2017 ND Defense EPA
```{r}
# Create plot
ggplot(nd_def_2017_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2017 Notre Dame Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

```{r}
y1_2017_stats <- create_team_summary(pbp = cfb_2017[cfb_2017$yards_to_goal >= 80,], 
                                team_logos = team_logos)

# Calculate statistics for 20 - 50
y2_2017_stats <- create_team_summary(pbp = cfb_2017[cfb_2017$yards_to_goal >= 50 &
                                                 cfb_2017$yards_to_goal < 80,], 
                                team_logos = team_logos)

# Calculate statistics for 50 - 79
y3_2017_stats <- create_team_summary(pbp = cfb_2017[cfb_2017$yards_to_goal >= 21 &
                                                 cfb_2017$yards_to_goal < 50,], 
                                team_logos = team_logos)
# Calculate statistics for 80 - 100
y4_2017_stats <- create_team_summary(pbp = cfb_2017[cfb_2017$yards_to_goal >= 0 &
                                                 cfb_2017$yards_to_goal < 20,], 
                                team_logos = team_logos)
```

2017 Notre Dame
```{r}
# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_yards_2017 <- rbind.data.frame(y1_2017_stats[y1_2017_stats$school == team,],
                             y2_2017_stats[y2_2017_stats$school == team,],
                             y3_2017_stats[y3_2017_stats$school == team,],
                             y4_2017_stats[y4_2017_stats$school == team,])

# Create plot for offensive EPA
nd_epa_off_2017 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2017, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
nd_epa_off_2017

# Create plot for offensive yards
nd_yards_2017 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2017, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
nd_yards_2017
```

2017 Defensive Stats
```{r}
# Create plot for defensive EPA
nd_epa_def_2017 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2017, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
nd_epa_def_2017

# Yards
# Create plot for defensive yards
nd_yards_2017_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2017, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
nd_yards_2017_def
```

## 2017 Michigan

2017 Michigan Offensive Stats
```{r}
mich_off_2017 <- cfb_2017[which(cfb_2017$pos_team == "Michigan" &
                     cfb_2017$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_off_2017_m <- melt(mich_off_2017[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2017 Michigan Offense EPA
```{r}
# Create plot
ggplot(mich_off_2017_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2017 Michigan Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2017 Michigan Defense
```{r}
mich_def_2017 <- cfb_2017[which(cfb_2017$def_pos_team == "Michigan" &
                     cfb_2017$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_def_2017_m <- melt(mich_def_2017[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```


2017 Michigan Defense EPA
```{r}
# Create plot
ggplot(mich_def_2017_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2017 Michigan Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

2017 Michigan Offense
```{r}
# Set team as Notre Dame
team <- "Michigan"

# Extract Notre Dame statistics
mich_by_yards_2017 <- rbind.data.frame(y1_2017_stats[y1_2017_stats$school == team,],
                             y2_2017_stats[y2_2017_stats$school == team,],
                             y3_2017_stats[y3_2017_stats$school == team,],
                             y4_2017_stats[y4_2017_stats$school == team,])

# Create plot for offensive EPA
mich_epa_off_2017 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2017, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
mich_epa_off_2017

# Create plot for offensive yards
mich_yards_2017 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2017, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
mich_yards_2017

```


2017 Michigan Defensive Stats
```{r}
# Create plot for defensive EPA
mich_epa_def_2017 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2017, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
mich_epa_def_2017

# Yards
# Create plot for defensive yards
mich_yards_2017_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2017, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
mich_yards_2017_def
```

### 2017 Notre Dame vs Michigan Matchup

```{r}
# Setting Data Up
# ND Pass and Rush Offense and Defense
nd_by_yards_2017$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
nd_by_yards_2017$zone_pass_num <- paste(nd_by_yards_2017$zone, ": ", nd_by_yards_2017$pass_n, sep = "")
nd_by_yards_2017$zone_rush_num <- paste(nd_by_yards_2017$zone, ": ", nd_by_yards_2017$rush_n, sep = "")
nd_by_yards_2017$zone_pass_num_def <- paste(nd_by_yards_2017$zone, ": ", nd_by_yards_2017$pass_n_def, sep = "")
nd_by_yards_2017$zone_rush_num_def <- paste(nd_by_yards_2017$zone, ": ", nd_by_yards_2017$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_yards_2017$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
mich_by_yards_2017$zone_pass_num <- paste(mich_by_yards_2017$zone, ": ", mich_by_yards_2017$pass_n, sep = "")
mich_by_yards_2017$zone_rush_num <- paste(mich_by_yards_2017$zone, ": ", mich_by_yards_2017$rush_n, sep = "")
mich_by_yards_2017$zone_pass_num_def <- paste(mich_by_yards_2017$zone, ": ", mich_by_yards_2017$pass_n_def, sep = "")
mich_by_yards_2017$zone_rush_num_def <- paste(mich_by_yards_2017$zone, ": ", mich_by_yards_2017$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2017 <- cbind.data.frame(nd_by_yards_2017$zone, 
                                    ((nd_by_yards_2017$pass_wpa_per_play + mich_by_yards_2017$pass_wpa_per_play_def)/2),
                                    ((nd_by_yards_2017$pass_epa_per_play + mich_by_yards_2017$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2017) <- c("zone", "exp_wpa", "exp_epa")
nd_v_mich_rush_2017 <- cbind.data.frame(nd_by_yards_2017$zone, 
                                    ((nd_by_yards_2017$rush_wpa_per_play + mich_by_yards_2017$rush_wpa_per_play_def)/2),
                                    ((nd_by_yards_2017$rush_epa_per_play + mich_by_yards_2017$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2017) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_pass_2017 <- cbind.data.frame(mich_by_yards_2017$zone, 
                                    ((mich_by_yards_2017$pass_wpa_per_play + nd_by_yards_2017$pass_wpa_per_play_def)/2),
                                    ((mich_by_yards_2017$pass_epa_per_play + nd_by_yards_2017$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2017) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_rush_2017 <- cbind.data.frame(mich_by_yards_2017$zone, 
                                    ((mich_by_yards_2017$rush_wpa_per_play + nd_by_yards_2017$rush_wpa_per_play_def)/2),
                                    ((mich_by_yards_2017$rush_epa_per_play + nd_by_yards_2017$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2017) <- c("zone", "exp_wpa", "exp_epa")

```


WPA Graphs by Field Position
```{r}
# ND Passing Offense vs Michigan Passing Defense
g_2017_1 <- ggplot(data = nd_v_mich_pass_2017, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2017_1

# ND Rushing Offense vs Michigan Rushing Defense
g_2017_2 <- ggplot(data = nd_v_mich_rush_2017, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2017_2

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2017_3 <- ggplot(data = mich_v_nd_pass_2017, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2017_3

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2017_4 <- ggplot(data = mich_v_nd_rush_2017, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2017_4
```
According to WPA by field position, this would be an incredibly balanced matchup. Generally, Notre Dame will have slightly more success passing the ball while Michigan will be slightly more successful at running the ball.



EPA Graphs by Field Position
```{r}

# ND Passing Offense vs Michigan Passing Defense
g_2017_5 <- ggplot(data = nd_v_mich_pass_2017, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2017_5

# ND Rushing Offense vs Michigan Rushing Defense
g_2017_6 <- ggplot(data = nd_v_mich_rush_2017, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2017_6

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2017_7 <- ggplot(data = mich_v_nd_pass_2017, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2017_7

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2017_8 <- ggplot(data = mich_v_nd_rush_2017, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2017_8
```
EPA by field position once again shows how close this matchup would be. This gives Notre Dame a more balanced approach on offense, but slightly favors the run. Michigan's also advocates a balanced attack, but slightly favors the pass here.

Extracting Plays by Downs
```{r}
z1_2017_stats <- create_team_summary(pbp = cfb_2017[cfb_2017$down == 1,], 
                                team_logos = team_logos)

# Calculate statistics for 2nd Down
z2_2017_stats <- create_team_summary(pbp = cfb_2017[cfb_2017$down == 2,], 
                                team_logos = team_logos)

# Calculate statistics for 3rd Down
z3_2017_stats <- create_team_summary(pbp = cfb_2017[cfb_2017$down == 3,], 
                                team_logos = team_logos)
# Calculate statistics for 4th Down
z4_2017_stats <- create_team_summary(pbp = cfb_2017[cfb_2017$down == 4,], 
                                team_logos = team_logos)

# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_down_2017 <- rbind.data.frame(z1_2017_stats[z1_2017_stats$school == team,],
                             z2_2017_stats[z2_2017_stats$school == team,],
                             z3_2017_stats[z3_2017_stats$school == team,],
                             z4_2017_stats[z4_2017_stats$school == team,])

# Set team as Michigan
team <- "Michigan"

# Extract Michigan statistics
mich_by_down_2017 <- rbind.data.frame(z1_2017_stats[z1_2017_stats$school == team,],
                             z2_2017_stats[z2_2017_stats$school == team,],
                             z3_2017_stats[z3_2017_stats$school == team,],
                             z4_2017_stats[z4_2017_stats$school == team,])

```

Setup Comparisons by Down

```{r}
# ND Pass and Rush Offense and Defense
nd_by_down_2017$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
nd_by_down_2017$down_pass_num <- paste(nd_by_down_2017$down, ": ", nd_by_down_2017$pass_n, sep = "")
nd_by_down_2017$down_rush_num <- paste(nd_by_down_2017$down, ": ", nd_by_down_2017$rush_n, sep = "")
nd_by_down_2017$down_pass_num_def <- paste(nd_by_down_2017$down, ": ", nd_by_down_2017$pass_n_def, sep = "")
nd_by_down_2017$down_rush_num_def <- paste(nd_by_down_2017$down, ": ", nd_by_down_2017$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_down_2017$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
mich_by_down_2017$down_pass_num <- paste(mich_by_down_2017$down, ": ", mich_by_down_2017$pass_n, sep = "")
mich_by_down_2017$down_rush_num <- paste(mich_by_down_2017$down, ": ", mich_by_down_2017$rush_n, sep = "")
mich_by_down_2017$down_pass_num_def <- paste(mich_by_down_2017$down, ": ", mich_by_down_2017$pass_n_def, sep = "")
mich_by_down_2017$down_rush_num_def <- paste(mich_by_down_2017$down, ": ", mich_by_down_2017$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2017_down <- cbind.data.frame(nd_by_down_2017$down, 
                                    ((nd_by_down_2017$pass_wpa_per_play + mich_by_down_2017$pass_wpa_per_play_def)/2),
                                    ((nd_by_down_2017$pass_epa_per_play + mich_by_down_2017$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2017_down) <- c("down", "exp_wpa", "exp_epa")
nd_v_mich_rush_2017_down <- cbind.data.frame(nd_by_down_2017$down, 
                                    ((nd_by_down_2017$rush_wpa_per_play + mich_by_down_2017$rush_wpa_per_play_def)/2),
                                    ((nd_by_down_2017$rush_epa_per_play + mich_by_down_2017$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2017_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_pass_2017_down <- cbind.data.frame(mich_by_down_2017$down, 
                                    ((mich_by_down_2017$pass_wpa_per_play + nd_by_down_2017$pass_wpa_per_play_def)/2),
                                    ((mich_by_down_2017$pass_epa_per_play + nd_by_down_2017$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2017_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_rush_2017_down <- cbind.data.frame(mich_by_down_2017$down, 
                                    ((mich_by_down_2017$rush_wpa_per_play + nd_by_down_2017$rush_wpa_per_play_def)/2),
                                    ((mich_by_down_2017$rush_epa_per_play + nd_by_down_2017$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2017_down) <- c("down", "exp_wpa", "exp_epa")

```

WPA Graphs by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2017_1 <- ggplot(data = nd_v_mich_pass_2017_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2017_1

# ND Rushing Offense vs Michigan Rushing Defense
d_2017_2 <- ggplot(data = nd_v_mich_rush_2017_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2017_2

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2017_3 <- ggplot(data = mich_v_nd_pass_2017_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2017_3

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2017_4 <- ggplot(data = mich_v_nd_rush_2017_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2017_4
```
These series of graphs show that Notre Dame is likely going to be more successful on the ground, while Michigan will be much better suited to pass the ball except on 3rd down.


EPA by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2017_5 <- ggplot(data = nd_v_mich_pass_2017_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2017_5

# ND Rushing Offense vs Michigan Rushing Defense
d_2017_6 <- ggplot(data = nd_v_mich_rush_2017_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2017_6

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2017_7 <- ggplot(data = mich_v_nd_pass_2017_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2017_7

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2017_8 <- ggplot(data = mich_v_nd_rush_2017_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2017 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2017_8
```
This has similar conclusions, Notre Dame is likely to be more successful with the rushing attack, Michigan will be more successful throwing the ball. Michigan's passing attack has the best matchup.

### 2020 Season

Load 2020 Season
```{r}
# Load data
cfb_2020 <- load_cfb_pbp(seasons = 2020)
# Convert to data frame
cfb_2020 <- as.data.frame(cfb_2020)
```

Play by Play
```{r}
# Create summarized play type
s_play_type <- create_simplex_play_type(cfb_2020)
# Add summarized play type back to dataset
cfb_2020$playtype <- s_play_type
```



2020 Notre Dame Offensive Stats
```{r}
nd_off_2020 <- cfb_2020[which(cfb_2020$pos_team == "Notre Dame" &
                     cfb_2020$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_off_2020_m <- melt(nd_off_2020[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))

```

2020 ND Offense EPA
```{r}
# Create plot
ggplot(nd_off_2020_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2020 Notre Dame Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2020 Notre Dame Defense
```{r}
nd_def_2020 <- cfb_2020[which(cfb_2020$def_pos_team == "Notre Dame" &
                     cfb_2020$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_def_2020_m <- melt(nd_def_2020[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2020 ND Defense EPA
```{r}
# Create plot
ggplot(nd_def_2020_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2020 Notre Dame Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

```{r}
y1_2020_stats <- create_team_summary(pbp = cfb_2020[cfb_2020$yards_to_goal >= 80,], 
                                team_logos = team_logos)

# Calculate statistics for 20 - 50
y2_2020_stats <- create_team_summary(pbp = cfb_2020[cfb_2020$yards_to_goal >= 50 &
                                                 cfb_2020$yards_to_goal < 80,], 
                                team_logos = team_logos)

# Calculate statistics for 50 - 79
y3_2020_stats <- create_team_summary(pbp = cfb_2020[cfb_2020$yards_to_goal >= 21 &
                                                 cfb_2020$yards_to_goal < 50,], 
                                team_logos = team_logos)
# Calculate statistics for 80 - 100
y4_2020_stats <- create_team_summary(pbp = cfb_2020[cfb_2020$yards_to_goal >= 0 &
                                                 cfb_2020$yards_to_goal < 20,], 
                                team_logos = team_logos)
```

2020 Notre Dame Offense
```{r}
# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_yards_2020 <- rbind.data.frame(y1_2020_stats[y1_2020_stats$school == team,],
                             y2_2020_stats[y2_2020_stats$school == team,],
                             y3_2020_stats[y3_2020_stats$school == team,],
                             y4_2020_stats[y4_2020_stats$school == team,])

# Create plot for offensive EPA
nd_epa_off_2020 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2020, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
nd_epa_off_2020

# Create plot for offensive yards
nd_yards_2020 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2020, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
nd_yards_2020
```

2020 Defensive Stats
```{r}
# Create plot for defensive EPA
nd_epa_def_2020 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2020, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
nd_epa_def_2020

# Yards
# Create plot for defensive yards
nd_yards_2020_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2020, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
nd_yards_2020_def
```

## 2020 Michigan

2020 Michigan Offensive Stats
```{r}
mich_off_2020 <- cfb_2020[which(cfb_2020$pos_team == "Michigan" &
                     cfb_2020$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_off_2020_m <- melt(mich_off_2020[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2020 Michigan Offense EPA
```{r}
# Create plot
ggplot(mich_off_2020_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2020 Michigan Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2020 Michigan Defense
```{r}
mich_def_2020 <- cfb_2020[which(cfb_2020$def_pos_team == "Michigan" &
                     cfb_2020$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_def_2020_m <- melt(mich_def_2020[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```


2020 Michigan Defense EPA
```{r}
# Create plot
ggplot(mich_def_2020_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2020 Michigan Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

2020 Michigan Offense
```{r}
# Set team as Notre Dame
team <- "Michigan"

# Extract Notre Dame statistics
mich_by_yards_2020 <- rbind.data.frame(y1_2020_stats[y1_2020_stats$school == team,],
                             y2_2020_stats[y2_2020_stats$school == team,],
                             y3_2020_stats[y3_2020_stats$school == team,],
                             y4_2020_stats[y4_2020_stats$school == team,])

# Create plot for offensive EPA
mich_epa_off_2020 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2020, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
mich_epa_off_2020

# Create plot for offensive yards
mich_yards_2020 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2020, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
mich_yards_2020

```


2020 Michigan Defensive Stats
```{r}
# Create plot for defensive EPA
mich_epa_def_2020 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2020, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
mich_epa_def_2020

# Yards
# Create plot for defensive yards
mich_yards_2020_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2020, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
mich_yards_2020_def
```

### 2020 Notre Dame vs Michigan Matchup

```{r}
# Setting Data Up
# ND Pass and Rush Offense and Defense
nd_by_yards_2020$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
nd_by_yards_2020$zone_pass_num <- paste(nd_by_yards_2020$zone, ": ", nd_by_yards_2020$pass_n, sep = "")
nd_by_yards_2020$zone_rush_num <- paste(nd_by_yards_2020$zone, ": ", nd_by_yards_2020$rush_n, sep = "")
nd_by_yards_2020$zone_pass_num_def <- paste(nd_by_yards_2020$zone, ": ", nd_by_yards_2020$pass_n_def, sep = "")
nd_by_yards_2020$zone_rush_num_def <- paste(nd_by_yards_2020$zone, ": ", nd_by_yards_2020$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_yards_2020$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
mich_by_yards_2020$zone_pass_num <- paste(mich_by_yards_2020$zone, ": ", mich_by_yards_2020$pass_n, sep = "")
mich_by_yards_2020$zone_rush_num <- paste(mich_by_yards_2020$zone, ": ", mich_by_yards_2020$rush_n, sep = "")
mich_by_yards_2020$zone_pass_num_def <- paste(mich_by_yards_2020$zone, ": ", mich_by_yards_2020$pass_n_def, sep = "")
mich_by_yards_2020$zone_rush_num_def <- paste(mich_by_yards_2020$zone, ": ", mich_by_yards_2020$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2020 <- cbind.data.frame(nd_by_yards_2020$zone, 
                                    ((nd_by_yards_2020$pass_wpa_per_play + mich_by_yards_2020$pass_wpa_per_play_def)/2),
                                    ((nd_by_yards_2020$pass_epa_per_play + mich_by_yards_2020$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2020) <- c("zone", "exp_wpa", "exp_epa")
nd_v_mich_rush_2020 <- cbind.data.frame(nd_by_yards_2020$zone, 
                                    ((nd_by_yards_2020$rush_wpa_per_play + mich_by_yards_2020$rush_wpa_per_play_def)/2),
                                    ((nd_by_yards_2020$rush_epa_per_play + mich_by_yards_2020$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2020) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_pass_2020 <- cbind.data.frame(mich_by_yards_2020$zone, 
                                    ((mich_by_yards_2020$pass_wpa_per_play + nd_by_yards_2020$pass_wpa_per_play_def)/2),
                                    ((mich_by_yards_2020$pass_epa_per_play + nd_by_yards_2020$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2020) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_rush_2020 <- cbind.data.frame(mich_by_yards_2020$zone, 
                                    ((mich_by_yards_2020$rush_wpa_per_play + nd_by_yards_2020$rush_wpa_per_play_def)/2),
                                    ((mich_by_yards_2020$rush_epa_per_play + nd_by_yards_2020$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2020) <- c("zone", "exp_wpa", "exp_epa")

```


WPA Graphs by Field Position
```{r}
# ND Passing Offense vs Michigan Passing Defense
g_2020_1 <- ggplot(data = nd_v_mich_pass_2020, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2020_1

# ND Rushing Offense vs Michigan Rushing Defense
g_2020_2 <- ggplot(data = nd_v_mich_rush_2020, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2020_2

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2020_3 <- ggplot(data = mich_v_nd_pass_2020, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2020_3

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2020_4 <- ggplot(data = mich_v_nd_rush_2020, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2020_4
```
According to WPA by field position, Notre Dame's offense generally has far more favorable matchups against Michigan than the other way around. ND's passing offense against Michigan's passing defense serves as the best individual matchup.



EPA Graphs by Field Position
```{r}

# ND Passing Offense vs Michigan Passing Defense
g_2020_5 <- ggplot(data = nd_v_mich_pass_2020, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2020_5

# ND Rushing Offense vs Michigan Rushing Defense
g_2020_6 <- ggplot(data = nd_v_mich_rush_2020, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2020_6

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2020_7 <- ggplot(data = mich_v_nd_pass_2020, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2020_7

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2020_8 <- ggplot(data = mich_v_nd_rush_2020, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2020_8
```
Similar situation to previous graph, Notre Dame would fare incredibly well throwing the ball and fairly well running the ball, while Michigan would throw the ball okay but struggle running the ball.


Extracting Plays by Downs
```{r}
z1_2020_stats <- create_team_summary(pbp = cfb_2020[cfb_2020$down == 1,], 
                                team_logos = team_logos)

# Calculate statistics for 2nd Down
z2_2020_stats <- create_team_summary(pbp = cfb_2020[cfb_2020$down == 2,], 
                                team_logos = team_logos)

# Calculate statistics for 3rd Down
z3_2020_stats <- create_team_summary(pbp = cfb_2020[cfb_2020$down == 3,], 
                                team_logos = team_logos)
# Calculate statistics for 4th Down
z4_2020_stats <- create_team_summary(pbp = cfb_2020[cfb_2020$down == 4,], 
                                team_logos = team_logos)

# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_down_2020 <- rbind.data.frame(z1_2020_stats[z1_2020_stats$school == team,],
                             z2_2020_stats[z2_2020_stats$school == team,],
                             z3_2020_stats[z3_2020_stats$school == team,],
                             z4_2020_stats[z4_2020_stats$school == team,])

# Set team as Michigan
team <- "Michigan"

# Extract Michigan statistics
mich_by_down_2020 <- rbind.data.frame(z1_2020_stats[z1_2020_stats$school == team,],
                             z2_2020_stats[z2_2020_stats$school == team,],
                             z3_2020_stats[z3_2020_stats$school == team,],
                             z4_2020_stats[z4_2020_stats$school == team,])

```

Setup Comparisons by Down

```{r}
# ND Pass and Rush Offense and Defense
nd_by_down_2020$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
nd_by_down_2020$down_pass_num <- paste(nd_by_down_2020$down, ": ", nd_by_down_2020$pass_n, sep = "")
nd_by_down_2020$down_rush_num <- paste(nd_by_down_2020$down, ": ", nd_by_down_2020$rush_n, sep = "")
nd_by_down_2020$down_pass_num_def <- paste(nd_by_down_2020$down, ": ", nd_by_down_2020$pass_n_def, sep = "")
nd_by_down_2020$down_rush_num_def <- paste(nd_by_down_2020$down, ": ", nd_by_down_2020$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_down_2020$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
mich_by_down_2020$down_pass_num <- paste(mich_by_down_2020$down, ": ", mich_by_down_2020$pass_n, sep = "")
mich_by_down_2020$down_rush_num <- paste(mich_by_down_2020$down, ": ", mich_by_down_2020$rush_n, sep = "")
mich_by_down_2020$down_pass_num_def <- paste(mich_by_down_2020$down, ": ", mich_by_down_2020$pass_n_def, sep = "")
mich_by_down_2020$down_rush_num_def <- paste(mich_by_down_2020$down, ": ", mich_by_down_2020$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2020_down <- cbind.data.frame(nd_by_down_2020$down, 
                                    ((nd_by_down_2020$pass_wpa_per_play + mich_by_down_2020$pass_wpa_per_play_def)/2),
                                    ((nd_by_down_2020$pass_epa_per_play + mich_by_down_2020$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2020_down) <- c("down", "exp_wpa", "exp_epa")
nd_v_mich_rush_2020_down <- cbind.data.frame(nd_by_down_2020$down, 
                                    ((nd_by_down_2020$rush_wpa_per_play + mich_by_down_2020$rush_wpa_per_play_def)/2),
                                    ((nd_by_down_2020$rush_epa_per_play + mich_by_down_2020$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2020_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_pass_2020_down <- cbind.data.frame(mich_by_down_2020$down, 
                                    ((mich_by_down_2020$pass_wpa_per_play + nd_by_down_2020$pass_wpa_per_play_def)/2),
                                    ((mich_by_down_2020$pass_epa_per_play + nd_by_down_2020$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2020_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_rush_2020_down <- cbind.data.frame(mich_by_down_2020$down, 
                                    ((mich_by_down_2020$rush_wpa_per_play + nd_by_down_2020$rush_wpa_per_play_def)/2),
                                    ((mich_by_down_2020$rush_epa_per_play + nd_by_down_2020$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2020_down) <- c("down", "exp_wpa", "exp_epa")

```

WPA Graphs by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2020_1 <- ggplot(data = nd_v_mich_pass_2020_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2020_1

# ND Rushing Offense vs Michigan Rushing Defense
d_2020_2 <- ggplot(data = nd_v_mich_rush_2020_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2020_2

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2020_3 <- ggplot(data = mich_v_nd_pass_2020_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2020_3

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2020_4 <- ggplot(data = mich_v_nd_rush_2020_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2020_4
```
Notre Dame's passing offense is the best individual matchup here. Both Michigan and ND would pass it fine, but Notre Dame wpuld dominate on the ground.


EPA by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2020_5 <- ggplot(data = nd_v_mich_pass_2020_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2020_5

# ND Rushing Offense vs Michigan Rushing Defense
d_2020_6 <- ggplot(data = nd_v_mich_rush_2020_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2020_6

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2020_7 <- ggplot(data = mich_v_nd_pass_2020_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2020_7

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2020_8 <- ggplot(data = mich_v_nd_rush_2020_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2020 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2020_8
```

Similar situation, Notre Dame passing offense and favorable rushing offense beats Michigan's passing offense and unfavorable rushing offense.

### 2021 Season

Load 2021 Season
```{r}
# Load data
cfb_2021 <- load_cfb_pbp(seasons = 2021)
# Convert to data frame
cfb_2021 <- as.data.frame(cfb_2021)
```

Play by Play
```{r}
# Create summarized play type
s_play_type <- create_simplex_play_type(cfb_2021)
# Add summarized play type back to dataset
cfb_2021$playtype <- s_play_type
```



2021 Notre Dame Offensive Stats
```{r}
nd_off_2021 <- cfb_2021[which(cfb_2021$pos_team == "Notre Dame" &
                     cfb_2021$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_off_2021_m <- melt(nd_off_2021[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))

```

2020 ND Offense EPA
```{r}
# Create plot
ggplot(nd_off_2021_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2021 Notre Dame Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2021 Notre Dame Defense
```{r}
nd_def_2021 <- cfb_2021[which(cfb_2021$def_pos_team == "Notre Dame" &
                     cfb_2021$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_def_2021_m <- melt(nd_def_2021[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2021 ND Defense EPA
```{r}
# Create plot
ggplot(nd_def_2021_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2021 Notre Dame Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

```{r}
y1_2021_stats <- create_team_summary(pbp = cfb_2021[cfb_2021$yards_to_goal >= 80,], 
                                team_logos = team_logos)

# Calculate statistics for 20 - 50
y2_2021_stats <- create_team_summary(pbp = cfb_2021[cfb_2021$yards_to_goal >= 50 &
                                                 cfb_2021$yards_to_goal < 80,], 
                                team_logos = team_logos)

# Calculate statistics for 50 - 79
y3_2021_stats <- create_team_summary(pbp = cfb_2021[cfb_2021$yards_to_goal >= 21 &
                                                 cfb_2021$yards_to_goal < 50,], 
                                team_logos = team_logos)
# Calculate statistics for 80 - 100
y4_2021_stats <- create_team_summary(pbp = cfb_2021[cfb_2021$yards_to_goal >= 0 &
                                                 cfb_2021$yards_to_goal < 20,], 
                                team_logos = team_logos)
```

2021 Notre Dame Offense
```{r}
# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_yards_2021 <- rbind.data.frame(y1_2021_stats[y1_2021_stats$school == team,],
                             y2_2021_stats[y2_2021_stats$school == team,],
                             y3_2021_stats[y3_2021_stats$school == team,],
                             y4_2021_stats[y4_2021_stats$school == team,])

# Create plot for offensive EPA
nd_epa_off_2021 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2021, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
nd_epa_off_2021

# Create plot for offensive yards
nd_yards_2021 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2021, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
nd_yards_2021
```

2021 Defensive Stats
```{r}
# Create plot for defensive EPA
nd_epa_def_2021 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2021, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
nd_epa_def_2021

# Yards
# Create plot for defensive yards
nd_yards_2021_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2021, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
nd_yards_2021_def
```

## 2021 Michigan

2021 Michigan Offensive Stats
```{r}
mich_off_2021 <- cfb_2021[which(cfb_2021$pos_team == "Michigan" &
                     cfb_2021$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_off_2021_m <- melt(mich_off_2021[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2021 Michigan Offense EPA
```{r}
# Create plot
ggplot(mich_off_2021_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2021 Michigan Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2021 Michigan Defense
```{r}
mich_def_2021 <- cfb_2021[which(cfb_2021$def_pos_team == "Michigan" &
                     cfb_2021$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_def_2021_m <- melt(mich_def_2021[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```


2021 Michigan Defense EPA
```{r}
# Create plot
ggplot(mich_def_2021_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2021 Michigan Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

2021 Michigan Offense
```{r}
# Set team as Notre Dame
team <- "Michigan"

# Extract Notre Dame statistics
mich_by_yards_2021 <- rbind.data.frame(y1_2021_stats[y1_2021_stats$school == team,],
                             y2_2021_stats[y2_2021_stats$school == team,],
                             y3_2021_stats[y3_2021_stats$school == team,],
                             y4_2021_stats[y4_2021_stats$school == team,])

# Create plot for offensive EPA
mich_epa_off_2021 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2021, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
mich_epa_off_2021

# Create plot for offensive yards
mich_yards_2021 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2021, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
mich_yards_2021

```


2021 Michigan Defensive Stats
```{r}
# Create plot for defensive EPA
mich_epa_def_2021 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2021, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
mich_epa_def_2021

# Yards
# Create plot for defensive yards
mich_yards_2021_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2021, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
mich_yards_2021_def
```

## 2021 Notre Dame vs Michigan Matchup

```{r}
# Setting Data Up
# ND Pass and Rush Offense and Defense
nd_by_yards_2021$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
nd_by_yards_2021$zone_pass_num <- paste(nd_by_yards_2021$zone, ": ", nd_by_yards_2021$pass_n, sep = "")
nd_by_yards_2021$zone_rush_num <- paste(nd_by_yards_2021$zone, ": ", nd_by_yards_2021$rush_n, sep = "")
nd_by_yards_2021$zone_pass_num_def <- paste(nd_by_yards_2021$zone, ": ", nd_by_yards_2021$pass_n_def, sep = "")
nd_by_yards_2021$zone_rush_num_def <- paste(nd_by_yards_2021$zone, ": ", nd_by_yards_2021$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_yards_2021$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
mich_by_yards_2021$zone_pass_num <- paste(mich_by_yards_2021$zone, ": ", mich_by_yards_2021$pass_n, sep = "")
mich_by_yards_2021$zone_rush_num <- paste(mich_by_yards_2021$zone, ": ", mich_by_yards_2021$rush_n, sep = "")
mich_by_yards_2021$zone_pass_num_def <- paste(mich_by_yards_2021$zone, ": ", mich_by_yards_2021$pass_n_def, sep = "")
mich_by_yards_2021$zone_rush_num_def <- paste(mich_by_yards_2021$zone, ": ", mich_by_yards_2021$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2021 <- cbind.data.frame(nd_by_yards_2021$zone, 
                                    ((nd_by_yards_2021$pass_wpa_per_play + mich_by_yards_2021$pass_wpa_per_play_def)/2),
                                    ((nd_by_yards_2021$pass_epa_per_play + mich_by_yards_2021$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2021) <- c("zone", "exp_wpa", "exp_epa")
nd_v_mich_rush_2021 <- cbind.data.frame(nd_by_yards_2021$zone, 
                                    ((nd_by_yards_2021$rush_wpa_per_play + mich_by_yards_2021$rush_wpa_per_play_def)/2),
                                    ((nd_by_yards_2021$rush_epa_per_play + mich_by_yards_2021$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2021) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_pass_2021 <- cbind.data.frame(mich_by_yards_2021$zone, 
                                    ((mich_by_yards_2021$pass_wpa_per_play + nd_by_yards_2021$pass_wpa_per_play_def)/2),
                                    ((mich_by_yards_2021$pass_epa_per_play + nd_by_yards_2021$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2021) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_rush_2021 <- cbind.data.frame(mich_by_yards_2021$zone, 
                                    ((mich_by_yards_2021$rush_wpa_per_play + nd_by_yards_2021$rush_wpa_per_play_def)/2),
                                    ((mich_by_yards_2021$rush_epa_per_play + nd_by_yards_2021$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2021) <- c("zone", "exp_wpa", "exp_epa")

```


WPA Graphs by Field Position
```{r}
# ND Passing Offense vs Michigan Passing Defense
g_2021_1 <- ggplot(data = nd_v_mich_pass_2021, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2021_1

# ND Rushing Offense vs Michigan Rushing Defense
g_2021_2 <- ggplot(data = nd_v_mich_rush_2021, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2021_2

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2021_3 <- ggplot(data = mich_v_nd_pass_2021, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2021_3

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2021_4 <- ggplot(data = mich_v_nd_rush_2021, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2021_4
```
Michigan with an easy advantage here. Notre Dame passing offense is better, but rushing offense is non existent. Michigan offense in general can move on ND's defense.



EPA Graphs by Field Position
```{r}

# ND Passing Offense vs Michigan Passing Defense
g_2021_5 <- ggplot(data = nd_v_mich_pass_2021, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2021_5

# ND Rushing Offense vs Michigan Rushing Defense
g_2021_6 <- ggplot(data = nd_v_mich_rush_2021, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2021_6

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2021_7 <- ggplot(data = mich_v_nd_pass_2021, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2021_7

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2021_8 <- ggplot(data = mich_v_nd_rush_2021, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2021_8
```
Paints a better picture for the Irish passing attack, but they would still be outclassed on the ground. Michigan rushing offense looking generally better compared to their passing attack, but a balanced approach would be encouraged.


Extracting Plays by Downs
```{r}
z1_2021_stats <- create_team_summary(pbp = cfb_2021[cfb_2021$down == 1,], 
                                team_logos = team_logos)

# Calculate statistics for 2nd Down
z2_2021_stats <- create_team_summary(pbp = cfb_2021[cfb_2021$down == 2,], 
                                team_logos = team_logos)

# Calculate statistics for 3rd Down
z3_2021_stats <- create_team_summary(pbp = cfb_2021[cfb_2021$down == 3,], 
                                team_logos = team_logos)
# Calculate statistics for 4th Down
z4_2021_stats <- create_team_summary(pbp = cfb_2021[cfb_2021$down == 4,], 
                                team_logos = team_logos)

# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_down_2021 <- rbind.data.frame(z1_2021_stats[z1_2021_stats$school == team,],
                             z2_2021_stats[z2_2021_stats$school == team,],
                             z3_2021_stats[z3_2021_stats$school == team,],
                             z4_2021_stats[z4_2021_stats$school == team,])

# Set team as Michigan
team <- "Michigan"

# Extract Michigan statistics
mich_by_down_2021 <- rbind.data.frame(z1_2021_stats[z1_2021_stats$school == team,],
                             z2_2021_stats[z2_2021_stats$school == team,],
                             z3_2021_stats[z3_2021_stats$school == team,],
                             z4_2021_stats[z4_2021_stats$school == team,])

```

Setup Comparisons by Down

```{r}
# ND Pass and Rush Offense and Defense
nd_by_down_2021$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
nd_by_down_2021$down_pass_num <- paste(nd_by_down_2021$down, ": ", nd_by_down_2021$pass_n, sep = "")
nd_by_down_2021$down_rush_num <- paste(nd_by_down_2021$down, ": ", nd_by_down_2021$rush_n, sep = "")
nd_by_down_2021$down_pass_num_def <- paste(nd_by_down_2021$down, ": ", nd_by_down_2021$pass_n_def, sep = "")
nd_by_down_2021$down_rush_num_def <- paste(nd_by_down_2021$down, ": ", nd_by_down_2021$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_down_2021$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
mich_by_down_2021$down_pass_num <- paste(mich_by_down_2021$down, ": ", mich_by_down_2021$pass_n, sep = "")
mich_by_down_2021$down_rush_num <- paste(mich_by_down_2021$down, ": ", mich_by_down_2021$rush_n, sep = "")
mich_by_down_2021$down_pass_num_def <- paste(mich_by_down_2021$down, ": ", mich_by_down_2021$pass_n_def, sep = "")
mich_by_down_2021$down_rush_num_def <- paste(mich_by_down_2021$down, ": ", mich_by_down_2021$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2021_down <- cbind.data.frame(nd_by_down_2021$down, 
                                    ((nd_by_down_2021$pass_wpa_per_play + mich_by_down_2021$pass_wpa_per_play_def)/2),
                                    ((nd_by_down_2021$pass_epa_per_play + mich_by_down_2021$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2021_down) <- c("down", "exp_wpa", "exp_epa")
nd_v_mich_rush_2021_down <- cbind.data.frame(nd_by_down_2021$down, 
                                    ((nd_by_down_2021$rush_wpa_per_play + mich_by_down_2021$rush_wpa_per_play_def)/2),
                                    ((nd_by_down_2021$rush_epa_per_play + mich_by_down_2021$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2021_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_pass_2021_down <- cbind.data.frame(mich_by_down_2021$down, 
                                    ((mich_by_down_2021$pass_wpa_per_play + nd_by_down_2021$pass_wpa_per_play_def)/2),
                                    ((mich_by_down_2021$pass_epa_per_play + nd_by_down_2021$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2021_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_rush_2021_down <- cbind.data.frame(mich_by_down_2021$down, 
                                    ((mich_by_down_2021$rush_wpa_per_play + nd_by_down_2021$rush_wpa_per_play_def)/2),
                                    ((mich_by_down_2021$rush_epa_per_play + nd_by_down_2021$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2021_down) <- c("down", "exp_wpa", "exp_epa")

```

WPA Graphs by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2021_1 <- ggplot(data = nd_v_mich_pass_2021_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2021_1

# ND Rushing Offense vs Michigan Rushing Defense
d_2021_2 <- ggplot(data = nd_v_mich_rush_2021_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2021_2

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2021_3 <- ggplot(data = mich_v_nd_pass_2021_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2021_3

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2021_4 <- ggplot(data = mich_v_nd_rush_2021_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2021_4
```
Offenses have an advantage, but Michigan's is performing better in both the pass and rush categories.


EPA by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2021_5 <- ggplot(data = nd_v_mich_pass_2021_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2021_5

# ND Rushing Offense vs Michigan Rushing Defense
d_2021_6 <- ggplot(data = nd_v_mich_rush_2021_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2021_6

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2021_7 <- ggplot(data = mich_v_nd_pass_2021_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2021_7

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2021_8 <- ggplot(data = mich_v_nd_rush_2021_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2021 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2021_8
```

Notre Dame would only fare decently by passing the ball, Michigan would be best taking a balanced approach.


### 2022 Season


Load 2022 Season
```{r}
# Load data
cfb_2022 <- load_cfb_pbp(seasons = 2022)
# Convert to data frame
cfb_2022 <- as.data.frame(cfb_2022)
```

Play by Play
```{r}
# Create summarized play type
s_play_type <- create_simplex_play_type(cfb_2022)
# Add summarized play type back to dataset
cfb_2022$playtype <- s_play_type

```



2022 Notre Dame Offensive Stats
```{r}
nd_off_2022 <- cfb_2022[which(cfb_2022$pos_team == "Notre Dame" &
                     cfb_2022$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_off_2022_m <- melt(nd_off_2022[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))

```

2022 ND Offense EPA
```{r}
# Create plot
ggplot(nd_off_2022_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2022 Notre Dame Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2022 Notre Dame Defense
```{r}
nd_def_2022 <- cfb_2022[which(cfb_2022$def_pos_team == "Notre Dame" &
                     cfb_2022$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_def_2022_m <- melt(nd_def_2022[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2022 ND Defense EPA
```{r}
# Create plot
ggplot(nd_def_2022_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2022 Notre Dame Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

```{r}
y1_2022_stats <- create_team_summary(pbp = cfb_2022[cfb_2022$yards_to_goal >= 80,], 
                                team_logos = team_logos)

# Calculate statistics for 20 - 50
y2_2022_stats <- create_team_summary(pbp = cfb_2022[cfb_2022$yards_to_goal >= 50 &
                                                 cfb_2022$yards_to_goal < 80,], 
                                team_logos = team_logos)

# Calculate statistics for 50 - 79
y3_2022_stats <- create_team_summary(pbp = cfb_2022[cfb_2022$yards_to_goal >= 21 &
                                                 cfb_2022$yards_to_goal < 50,], 
                                team_logos = team_logos)
# Calculate statistics for 80 - 100
y4_2022_stats <- create_team_summary(pbp = cfb_2022[cfb_2022$yards_to_goal >= 0 &
                                                 cfb_2022$yards_to_goal < 20,], 
                                team_logos = team_logos)
```

2022 Notre Dame Offense
```{r}
# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_yards_2022 <- rbind.data.frame(y1_2022_stats[y1_2022_stats$school == team,],
                             y2_2022_stats[y2_2022_stats$school == team,],
                             y3_2022_stats[y3_2022_stats$school == team,],
                             y4_2022_stats[y4_2022_stats$school == team,])

# Create plot for offensive EPA
nd_epa_off_2022 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2022, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
nd_epa_off_2022

# Create plot for offensive yards
nd_yards_2022 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2022, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
nd_yards_2022
```

2022 Defensive Stats
```{r}
# Create plot for defensive EPA
nd_epa_def_2022 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2022, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
nd_epa_def_2022

# Yards
# Create plot for defensive yards
nd_yards_2022_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2022, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
nd_yards_2022_def
```

## 2022 Michigan

2022 Michigan Offensive Stats
```{r}
mich_off_2022 <- cfb_2022[which(cfb_2022$pos_team == "Michigan" &
                     cfb_2022$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_off_2022_m <- melt(mich_off_2022[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2022 Michigan Offense EPA
```{r}
# Create plot
ggplot(mich_off_2022_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2022 Michigan Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2022 Michigan Defense
```{r}
mich_def_2022 <- cfb_2022[which(cfb_2022$def_pos_team == "Michigan" &
                     cfb_2022$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_def_2022_m <- melt(mich_def_2022[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```


2022 Michigan Defense EPA
```{r}
# Create plot
ggplot(mich_def_2022_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2022 Michigan Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

2022 Michigan Offense
```{r}
# Set team as Notre Dame
team <- "Michigan"

# Extract Notre Dame statistics
mich_by_yards_2022 <- rbind.data.frame(y1_2022_stats[y1_2022_stats$school == team,],
                             y2_2022_stats[y2_2022_stats$school == team,],
                             y3_2022_stats[y3_2022_stats$school == team,],
                             y4_2022_stats[y4_2022_stats$school == team,])

# Create plot for offensive EPA
mich_epa_off_2022 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2022, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
mich_epa_off_2022

# Create plot for offensive yards
mich_yards_2022 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2022, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
mich_yards_2022

```


2022 Michigan Defensive Stats
```{r}
# Create plot for defensive EPA
mich_epa_def_2022 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2022, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
mich_epa_def_2022

# Yards
# Create plot for defensive yards
mich_yards_2022_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2022, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
mich_yards_2022_def
```

### 2022 Notre Dame vs Michigan Matchup

```{r}
# Setting Data Up
# ND Pass and Rush Offense and Defense
nd_by_yards_2022$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
nd_by_yards_2022$zone_pass_num <- paste(nd_by_yards_2022$zone, ": ", nd_by_yards_2022$pass_n, sep = "")
nd_by_yards_2022$zone_rush_num <- paste(nd_by_yards_2022$zone, ": ", nd_by_yards_2022$rush_n, sep = "")
nd_by_yards_2022$zone_pass_num_def <- paste(nd_by_yards_2022$zone, ": ", nd_by_yards_2022$pass_n_def, sep = "")
nd_by_yards_2022$zone_rush_num_def <- paste(nd_by_yards_2022$zone, ": ", nd_by_yards_2022$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_yards_2022$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
mich_by_yards_2022$zone_pass_num <- paste(mich_by_yards_2022$zone, ": ", mich_by_yards_2022$pass_n, sep = "")
mich_by_yards_2022$zone_rush_num <- paste(mich_by_yards_2022$zone, ": ", mich_by_yards_2022$rush_n, sep = "")
mich_by_yards_2022$zone_pass_num_def <- paste(mich_by_yards_2022$zone, ": ", mich_by_yards_2022$pass_n_def, sep = "")
mich_by_yards_2022$zone_rush_num_def <- paste(mich_by_yards_2022$zone, ": ", mich_by_yards_2022$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2022 <- cbind.data.frame(nd_by_yards_2022$zone, 
                                    ((nd_by_yards_2022$pass_wpa_per_play + mich_by_yards_2022$pass_wpa_per_play_def)/2),
                                    ((nd_by_yards_2022$pass_epa_per_play + mich_by_yards_2022$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2022) <- c("zone", "exp_wpa", "exp_epa")
nd_v_mich_rush_2022 <- cbind.data.frame(nd_by_yards_2022$zone, 
                                    ((nd_by_yards_2022$rush_wpa_per_play + mich_by_yards_2022$rush_wpa_per_play_def)/2),
                                    ((nd_by_yards_2022$rush_epa_per_play + mich_by_yards_2022$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2022) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_pass_2022 <- cbind.data.frame(mich_by_yards_2022$zone, 
                                    ((mich_by_yards_2022$pass_wpa_per_play + nd_by_yards_2022$pass_wpa_per_play_def)/2),
                                    ((mich_by_yards_2022$pass_epa_per_play + nd_by_yards_2022$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2022) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_rush_2022 <- cbind.data.frame(mich_by_yards_2022$zone, 
                                    ((mich_by_yards_2022$rush_wpa_per_play + nd_by_yards_2022$rush_wpa_per_play_def)/2),
                                    ((mich_by_yards_2022$rush_epa_per_play + nd_by_yards_2022$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2022) <- c("zone", "exp_wpa", "exp_epa")

```


WPA Graphs by Field Position
```{r}
# ND Passing Offense vs Michigan Passing Defense
g_2022_1 <- ggplot(data = nd_v_mich_pass_2022, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2022_1

# ND Rushing Offense vs Michigan Rushing Defense
g_2022_2 <- ggplot(data = nd_v_mich_rush_2022, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2022_2

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2022_3 <- ggplot(data = mich_v_nd_pass_2022, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2022_3

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2022_4 <- ggplot(data = mich_v_nd_rush_2022, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2022_4
```
Notre Dame would once again be better served to go with the pass. Michigan would as well; Wolverines generally have an edge across the board.



EPA Graphs by Field Position
```{r}

# ND Passing Offense vs Michigan Passing Defense
g_2022_5 <- ggplot(data = nd_v_mich_pass_2022, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2022_5

# ND Rushing Offense vs Michigan Rushing Defense
g_2022_6 <- ggplot(data = nd_v_mich_rush_2022, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2022_6

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2022_7 <- ggplot(data = mich_v_nd_pass_2022, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2022_7

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2022_8 <- ggplot(data = mich_v_nd_rush_2022, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2022_8
```
Notre Dame would be better to pass the ball, while Michigan would use a more balanced attack.


Extracting Plays by Downs
```{r}
z1_2022_stats <- create_team_summary(pbp = cfb_2022[cfb_2022$down == 1,], 
                                team_logos = team_logos)

# Calculate statistics for 2nd Down
z2_2022_stats <- create_team_summary(pbp = cfb_2022[cfb_2022$down == 2,], 
                                team_logos = team_logos)

# Calculate statistics for 3rd Down
z3_2022_stats <- create_team_summary(pbp = cfb_2022[cfb_2022$down == 3,], 
                                team_logos = team_logos)
# Calculate statistics for 4th Down
z4_2022_stats <- create_team_summary(pbp = cfb_2022[cfb_2022$down == 4,], 
                                team_logos = team_logos)

# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_down_2022 <- rbind.data.frame(z1_2022_stats[z1_2022_stats$school == team,],
                             z2_2022_stats[z2_2022_stats$school == team,],
                             z3_2022_stats[z3_2022_stats$school == team,],
                             z4_2022_stats[z4_2022_stats$school == team,])

# Set team as Michigan
team <- "Michigan"

# Extract Michigan statistics
mich_by_down_2022 <- rbind.data.frame(z1_2022_stats[z1_2022_stats$school == team,],
                             z2_2022_stats[z2_2022_stats$school == team,],
                             z3_2022_stats[z3_2022_stats$school == team,],
                             z4_2022_stats[z4_2022_stats$school == team,])

```

Setup Comparisons by Down

```{r}
# ND Pass and Rush Offense and Defense
nd_by_down_2022$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
nd_by_down_2022$down_pass_num <- paste(nd_by_down_2022$down, ": ", nd_by_down_2022$pass_n, sep = "")
nd_by_down_2022$down_rush_num <- paste(nd_by_down_2022$down, ": ", nd_by_down_2022$rush_n, sep = "")
nd_by_down_2022$down_pass_num_def <- paste(nd_by_down_2022$down, ": ", nd_by_down_2022$pass_n_def, sep = "")
nd_by_down_2022$down_rush_num_def <- paste(nd_by_down_2022$down, ": ", nd_by_down_2022$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_down_2022$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
mich_by_down_2022$down_pass_num <- paste(mich_by_down_2022$down, ": ", mich_by_down_2022$pass_n, sep = "")
mich_by_down_2022$down_rush_num <- paste(mich_by_down_2022$down, ": ", mich_by_down_2022$rush_n, sep = "")
mich_by_down_2022$down_pass_num_def <- paste(mich_by_down_2022$down, ": ", mich_by_down_2022$pass_n_def, sep = "")
mich_by_down_2022$down_rush_num_def <- paste(mich_by_down_2022$down, ": ", mich_by_down_2022$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2022_down <- cbind.data.frame(nd_by_down_2022$down, 
                                    ((nd_by_down_2022$pass_wpa_per_play + mich_by_down_2022$pass_wpa_per_play_def)/2),
                                    ((nd_by_down_2022$pass_epa_per_play + mich_by_down_2022$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2022_down) <- c("down", "exp_wpa", "exp_epa")
nd_v_mich_rush_2022_down <- cbind.data.frame(nd_by_down_2022$down, 
                                    ((nd_by_down_2022$rush_wpa_per_play + mich_by_down_2022$rush_wpa_per_play_def)/2),
                                    ((nd_by_down_2022$rush_epa_per_play + mich_by_down_2022$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2022_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_pass_2022_down <- cbind.data.frame(mich_by_down_2022$down, 
                                    ((mich_by_down_2022$pass_wpa_per_play + nd_by_down_2022$pass_wpa_per_play_def)/2),
                                    ((mich_by_down_2022$pass_epa_per_play + nd_by_down_2022$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2022_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_rush_2022_down <- cbind.data.frame(mich_by_down_2022$down, 
                                    ((mich_by_down_2022$rush_wpa_per_play + nd_by_down_2022$rush_wpa_per_play_def)/2),
                                    ((mich_by_down_2022$rush_epa_per_play + nd_by_down_2022$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2022_down) <- c("down", "exp_wpa", "exp_epa")

```

WPA Graphs by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2022_1 <- ggplot(data = nd_v_mich_pass_2022_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2022_1

# ND Rushing Offense vs Michigan Rushing Defense
d_2022_2 <- ggplot(data = nd_v_mich_rush_2022_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2022_2

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2022_3 <- ggplot(data = mich_v_nd_pass_2022_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2022_3

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2022_4 <- ggplot(data = mich_v_nd_rush_2022_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2022_4
```
Irish - pass. Wolverines - balanced attack.


EPA by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2022_5 <- ggplot(data = nd_v_mich_pass_2022_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2022_5

# ND Rushing Offense vs Michigan Rushing Defense
d_2022_6 <- ggplot(data = nd_v_mich_rush_2022_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2022_6

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2022_7 <- ggplot(data = mich_v_nd_pass_2022_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2022_7

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2022_8 <- ggplot(data = mich_v_nd_rush_2022_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2022 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2022_8
```

Same as other analyses, but gives more favorability to Michigan's passing attack.

### 2023 Season

Load 2023 Season
```{r}
# Load data
cfb_2023 <- load_cfb_pbp(seasons = 2023)
# Convert to data frame
cfb_2023 <- as.data.frame(cfb_2023)
```

Play by Play
```{r}
# Create summarized play type
s_play_type <- create_simplex_play_type(cfb_2023)
# Add summarized play type back to dataset
cfb_2023$playtype <- s_play_type
```



2023 Notre Dame Offensive Stats
```{r}
nd_off_2023 <- cfb_2023[which(cfb_2023$pos_team == "Notre Dame" &
                     cfb_2023$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_off_2023_m <- melt(nd_off_2023[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))

```

2023 ND Offense EPA
```{r}
# Create plot
ggplot(nd_off_2023_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2023 Notre Dame Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2023 Notre Dame Defense
```{r}
nd_def_2023 <- cfb_2023[which(cfb_2023$def_pos_team == "Notre Dame" &
                     cfb_2023$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

nd_def_2023_m <- melt(nd_def_2023[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2023 ND Defense EPA
```{r}
# Create plot
ggplot(nd_def_2023_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2023 Notre Dame Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

```{r}
y1_2023_stats <- create_team_summary(pbp = cfb_2023[cfb_2023$yards_to_goal >= 80,], 
                                team_logos = team_logos)

# Calculate statistics for 20 - 50
y2_2023_stats <- create_team_summary(pbp = cfb_2023[cfb_2023$yards_to_goal >= 50 &
                                                 cfb_2023$yards_to_goal < 80,], 
                                team_logos = team_logos)

# Calculate statistics for 50 - 79
y3_2023_stats <- create_team_summary(pbp = cfb_2023[cfb_2023$yards_to_goal >= 21 &
                                                 cfb_2023$yards_to_goal < 50,], 
                                team_logos = team_logos)
# Calculate statistics for 80 - 100
y4_2023_stats <- create_team_summary(pbp = cfb_2023[cfb_2023$yards_to_goal >= 0 &
                                                 cfb_2023$yards_to_goal < 20,], 
                                team_logos = team_logos)
```

2023 Notre Dame Offense
```{r}
# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_yards_2023 <- rbind.data.frame(y1_2023_stats[y1_2023_stats$school == team,],
                             y2_2023_stats[y2_2023_stats$school == team,],
                             y3_2023_stats[y3_2023_stats$school == team,],
                             y4_2023_stats[y4_2023_stats$school == team,])

# Create plot for offensive EPA
nd_epa_off_2023 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2023, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
nd_epa_off_2023

# Create plot for offensive yards
nd_yards_2023 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2023, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
nd_yards_2023
```

2023 Defensive Stats
```{r}
# Create plot for defensive EPA
nd_epa_def_2023 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2023, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
nd_epa_def_2023

# Yards
# Create plot for defensive yards
nd_yards_2023_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Notre Dame", # Set  Team
                 res_1 = nd_by_yards_2023, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
nd_yards_2023_def
```

## 2023 Michigan

2023 Michigan Offensive Stats
```{r}
mich_off_2023 <- cfb_2023[which(cfb_2023$pos_team == "Michigan" &
                     cfb_2023$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_off_2023_m <- melt(mich_off_2023[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```

2023 Michigan Offense EPA
```{r}
# Create plot
ggplot(mich_off_2023_m, # Set dataset
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set geom density ridges
  theme_minimal() + # Set theme as minimal
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set labels for plot
       subtitle = "2023 Michigan Offense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw()+ # Convert to dark theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

2023 Michigan Defense
```{r}
mich_def_2023 <- cfb_2023[which(cfb_2023$def_pos_team == "Michigan" &
                     cfb_2023$playtype %in% c("Rush", "Pass")),
                       c("down", "playtype", "wpa", "EPA")]

mich_def_2023_m <- melt(mich_def_2023[,c("down", "playtype", "EPA")], id.vars = c("down", "playtype"))
```


2023 Michigan Defense EPA
```{r}
# Create plot
ggplot(mich_def_2023_m, # Set dataset 
       aes(x = value, y = factor(down), fill = factor(playtype)))+ # Set aesthetics
  geom_density_ridges(alpha = 0.5) + # Set density to create distribution
  theme_minimal() + # Set plot theme
  labs(x = "EPA", title = "EPA by Play Type and Down", # Set plot labels
       subtitle = "2023 Michigan Defense",
       fill = "Play Type", y = "Down") +
  scale_fill_manual(values = c("Pass" = "red", "Rush" = "Blue")) + # Set colors manually
  dark_theme_bw() + # Set theme
  geom_vline(xintercept = 0, linetype = 2, color = "white") # Add vertical line at 0

# Turn off dark mode
invert_geom_defaults()
```

By Field Position

2023 Michigan Offense
```{r}
# Set team as Notre Dame
team <- "Michigan"

# Extract Notre Dame statistics
mich_by_yards_2023 <- rbind.data.frame(y1_2023_stats[y1_2023_stats$school == team,],
                             y2_2023_stats[y2_2023_stats$school == team,],
                             y3_2023_stats[y3_2023_stats$school == team,],
                             y4_2023_stats[y4_2023_stats$school == team,])

# Create plot for offensive EPA
mich_epa_off_2023 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2023, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "off") # Set type of plot to generate
# Generate plot for offensive EPA
mich_epa_off_2023

# Create plot for offensive yards
mich_yards_2023 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2023, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "off") # Set type of plot to generate
# Generate plot
mich_yards_2023

```


2023 Michigan Defensive Stats
```{r}
# Create plot for defensive EPA
mich_epa_def_2023 <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2023, # Set  Team Stats
                 type = "EPA", # Set type as EPA
                 off_def = "def") # Set type of plot to generate
# Generate plot for defensive EPA
mich_epa_def_2023

# Yards
# Create plot for defensive yards
mich_yards_2023_def <- create_zone_plot(logos = team_logos, # Set team logos
                 t1 = "Michigan", # Set  Team
                 res_1 = mich_by_yards_2023, # Set  Team Stats
                 type = "Yards", # Set type as Yards
                 off_def = "def") # Set type of plot to generate
# Generate plot
mich_yards_2023_def
```

### 2023 Notre Dame vs Michigan Matchup

```{r}
# Setting Data Up
# ND Pass and Rush Offense and Defense
nd_by_yards_2023$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
nd_by_yards_2023$zone_pass_num <- paste(nd_by_yards_2023$zone, ": ", nd_by_yards_2023$pass_n, sep = "")
nd_by_yards_2023$zone_rush_num <- paste(nd_by_yards_2023$zone, ": ", nd_by_yards_2023$rush_n, sep = "")
nd_by_yards_2023$zone_pass_num_def <- paste(nd_by_yards_2023$zone, ": ", nd_by_yards_2023$pass_n_def, sep = "")
nd_by_yards_2023$zone_rush_num_def <- paste(nd_by_yards_2023$zone, ": ", nd_by_yards_2023$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_yards_2023$zone <- c("Own 20", "Own 20-50", "Opponent 20-50", "Opponent 20")
mich_by_yards_2023$zone_pass_num <- paste(mich_by_yards_2023$zone, ": ", mich_by_yards_2023$pass_n, sep = "")
mich_by_yards_2023$zone_rush_num <- paste(mich_by_yards_2023$zone, ": ", mich_by_yards_2023$rush_n, sep = "")
mich_by_yards_2023$zone_pass_num_def <- paste(mich_by_yards_2023$zone, ": ", mich_by_yards_2023$pass_n_def, sep = "")
mich_by_yards_2023$zone_rush_num_def <- paste(mich_by_yards_2023$zone, ": ", mich_by_yards_2023$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2023 <- cbind.data.frame(nd_by_yards_2023$zone, 
                                    ((nd_by_yards_2023$pass_wpa_per_play + mich_by_yards_2023$pass_wpa_per_play_def)/2),
                                    ((nd_by_yards_2023$pass_epa_per_play + mich_by_yards_2023$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2023) <- c("zone", "exp_wpa", "exp_epa")
nd_v_mich_rush_2023 <- cbind.data.frame(nd_by_yards_2023$zone, 
                                    ((nd_by_yards_2023$rush_wpa_per_play + mich_by_yards_2023$rush_wpa_per_play_def)/2),
                                    ((nd_by_yards_2023$rush_epa_per_play + mich_by_yards_2023$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2023) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_pass_2023 <- cbind.data.frame(mich_by_yards_2023$zone, 
                                    ((mich_by_yards_2023$pass_wpa_per_play + nd_by_yards_2023$pass_wpa_per_play_def)/2),
                                    ((mich_by_yards_2023$pass_epa_per_play + nd_by_yards_2023$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2023) <- c("zone", "exp_wpa", "exp_epa")
mich_v_nd_rush_2023 <- cbind.data.frame(mich_by_yards_2023$zone, 
                                    ((mich_by_yards_2023$rush_wpa_per_play + nd_by_yards_2023$rush_wpa_per_play_def)/2),
                                    ((mich_by_yards_2023$rush_epa_per_play + nd_by_yards_2023$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2023) <- c("zone", "exp_wpa", "exp_epa")

```


WPA Graphs by Field Position
```{r}
# ND Passing Offense vs Michigan Passing Defense
g_2023_1 <- ggplot(data = nd_v_mich_pass_2023, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2023_1

# ND Rushing Offense vs Michigan Rushing Defense
g_2023_2 <- ggplot(data = nd_v_mich_rush_2023, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2023_2

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2023_3 <- ggplot(data = mich_v_nd_pass_2023, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2023_3

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2023_4 <- ggplot(data = mich_v_nd_rush_2023, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2023_4
```

Both teams would be much better served to throw the ball primarily.

EPA Graphs by Field Position
```{r}

# ND Passing Offense vs Michigan Passing Defense
g_2023_5 <- ggplot(data = nd_v_mich_pass_2023, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2023_5

# ND Rushing Offense vs Michigan Rushing Defense
g_2023_6 <- ggplot(data = nd_v_mich_rush_2023, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2023_6

# Michigan Pass Offense vs Notre Dame Pass Defense
g_2023_7 <- ggplot(data = mich_v_nd_pass_2023, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Win Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2023_7

# Michigan Rush Offense vs Notre Dame Rush Defense
g_2023_8 <- ggplot(data = mich_v_nd_rush_2023, # Set dataset
              aes(x = zone,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = zone)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Field Zones", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
g_2023_8
```

Both teams would be much better positioned to throw the ball compared to running it.

Extracting Plays by Downs
```{r}
z1_2023_stats <- create_team_summary(pbp = cfb_2023[cfb_2023$down == 1,], 
                                team_logos = team_logos)

# Calculate statistics for 2nd Down
z2_2023_stats <- create_team_summary(pbp = cfb_2023[cfb_2023$down == 2,], 
                                team_logos = team_logos)

# Calculate statistics for 3rd Down
z3_2023_stats <- create_team_summary(pbp = cfb_2023[cfb_2023$down == 3,], 
                                team_logos = team_logos)
# Calculate statistics for 4th Down
z4_2023_stats <- create_team_summary(pbp = cfb_2023[cfb_2023$down == 4,], 
                                team_logos = team_logos)

# Set team as Notre Dame
team <- "Notre Dame"

# Extract Notre Dame statistics
nd_by_down_2023 <- rbind.data.frame(z1_2023_stats[z1_2023_stats$school == team,],
                             z2_2023_stats[z2_2023_stats$school == team,],
                             z3_2023_stats[z3_2023_stats$school == team,],
                             z4_2023_stats[z4_2023_stats$school == team,])

# Set team as Michigan
team <- "Michigan"

# Extract Michigan statistics
mich_by_down_2023 <- rbind.data.frame(z1_2023_stats[z1_2023_stats$school == team,],
                             z2_2023_stats[z2_2023_stats$school == team,],
                             z3_2023_stats[z3_2023_stats$school == team,],
                             z4_2023_stats[z4_2023_stats$school == team,])

```

Setup Comparisons by Down

```{r}
# ND Pass and Rush Offense and Defense
nd_by_down_2023$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
nd_by_down_2023$down_pass_num <- paste(nd_by_down_2023$down, ": ", nd_by_down_2023$pass_n, sep = "")
nd_by_down_2023$down_rush_num <- paste(nd_by_down_2023$down, ": ", nd_by_down_2023$rush_n, sep = "")
nd_by_down_2023$down_pass_num_def <- paste(nd_by_down_2023$down, ": ", nd_by_down_2023$pass_n_def, sep = "")
nd_by_down_2023$down_rush_num_def <- paste(nd_by_down_2023$down, ": ", nd_by_down_2023$rush_n_def, sep = "")

# Michigan Pass and Rush Offense and Defense
mich_by_down_2023$down <- c("1st Down", "2nd Down", "3rd Down", "4th Down")
mich_by_down_2023$down_pass_num <- paste(mich_by_down_2023$down, ": ", mich_by_down_2023$pass_n, sep = "")
mich_by_down_2023$down_rush_num <- paste(mich_by_down_2023$down, ": ", mich_by_down_2023$rush_n, sep = "")
mich_by_down_2023$down_pass_num_def <- paste(mich_by_down_2023$down, ": ", mich_by_down_2023$pass_n_def, sep = "")
mich_by_down_2023$down_rush_num_def <- paste(mich_by_down_2023$down, ": ", mich_by_down_2023$rush_n_def, sep = "")

# Create Different Combinations
nd_v_mich_pass_2023_down <- cbind.data.frame(nd_by_down_2023$down, 
                                    ((nd_by_down_2023$pass_wpa_per_play + mich_by_down_2023$pass_wpa_per_play_def)/2),
                                    ((nd_by_down_2023$pass_epa_per_play + mich_by_down_2023$pass_epa_per_play_def)/2))
names(nd_v_mich_pass_2023_down) <- c("down", "exp_wpa", "exp_epa")
nd_v_mich_rush_2023_down <- cbind.data.frame(nd_by_down_2023$down, 
                                    ((nd_by_down_2023$rush_wpa_per_play + mich_by_down_2023$rush_wpa_per_play_def)/2),
                                    ((nd_by_down_2023$rush_epa_per_play + mich_by_down_2023$rush_epa_per_play_def)/2))
names(nd_v_mich_rush_2023_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_pass_2023_down <- cbind.data.frame(mich_by_down_2023$down, 
                                    ((mich_by_down_2023$pass_wpa_per_play + nd_by_down_2023$pass_wpa_per_play_def)/2),
                                    ((mich_by_down_2023$pass_epa_per_play + nd_by_down_2023$pass_epa_per_play_def)/2))
names(mich_v_nd_pass_2023_down) <- c("down", "exp_wpa", "exp_epa")
mich_v_nd_rush_2023_down <- cbind.data.frame(mich_by_down_2023$down, 
                                    ((mich_by_down_2023$rush_wpa_per_play + nd_by_down_2023$rush_wpa_per_play_def)/2),
                                    ((mich_by_down_2023$rush_epa_per_play + nd_by_down_2023$rush_epa_per_play_def)/2))
names(mich_v_nd_rush_2023_down) <- c("down", "exp_wpa", "exp_epa")
```

WPA Graphs by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2023_1 <- ggplot(data = nd_v_mich_pass_2023_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2023_1

# ND Rushing Offense vs Michigan Rushing Defense
d_2023_2 <- ggplot(data = nd_v_mich_rush_2023_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Win Probability Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2023_2

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2023_3 <- ggplot(data = mich_v_nd_pass_2023_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2023_3

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2023_4 <- ggplot(data = mich_v_nd_rush_2023_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_wpa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Win Probability Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2023_4
```

Both teams would be better served to throw the ball compared to running it.

EPA by Down
```{r}
# ND Passing Offense vs Michigan Passing Defense
d_2023_5 <- ggplot(data = nd_v_mich_pass_2023_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Pass",
       title = "Notre Dame Passing Offense vs Michigan Pass Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2023_5

# ND Rushing Offense vs Michigan Rushing Defense
d_2023_6 <- ggplot(data = nd_v_mich_rush_2023_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Notre Dame's Expected Points Against Michigan Whenever They Rush",
       title = "Notre Dame Rush Offense vs Michigan Rush Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2023_6

# Michigan Pass Offense vs Notre Dame Pass Defense
d_2023_7 <- ggplot(data = mich_v_nd_pass_2023_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Pass",
       title = "Michigan Passing Offense vs Notre Dame Pass Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2023_7

# Michigan Rush Offense vs Notre Dame Rush Defense
d_2023_8 <- ggplot(data = mich_v_nd_rush_2023_down, # Set dataset
              aes(x = down,  # Set x axis as pitch type
                  y= exp_epa, # Set y as win probability change
                  fill = down)) + # Set fill as pitch type
  geom_bar(stat = "identity") + # Set geom bar for bar plot
  theme_bw() + # Set theme 
  coord_flip() + # Flip coordinates
  labs(x = "Down", # Set labels
       y = "Average Change in Michigan's Expected Points Against Notre Dame Whenever They Rush",
       title = "Michigan Rush Offense vs Notre Dame Rush Defense",
       subtitle = "2023 Season") +
  theme(panel.grid.major = element_blank(), # Remove grid
        panel.grid.minor = element_blank(), # Remove grid
        panel.border = element_blank(), # Remove grid
        panel.background = element_blank()) + # Remove grid
  guides(fill = NULL) # Turn off legend for fill
d_2023_8
```

Both teams would be much better served to throw the ball compared to running it.


